if (WIN32 AND FALSE)
   add_library(sliprock_static STATIC sliprock_windows.c)
   add_library(sliprock SHARED sliprock_windows.c)
elseif(UNIX OR TRUE)
   add_library(sliprock_static STATIC sliprock.c)
   add_library(sliprock SHARED sliprock.c)
else()
   message(FATAL_ERROR "Unsupported platform")
endif()
if (WIN32)
   target_link_libraries(sliprock sliprock_static userenv)
else()
   include_directories(${sodium_INCLUDE_DIR})
   target_link_libraries(sliprock sliprock_static sodium)
endif()
if(GTEST_FOUND AND NOT DEFINED SLIPROCK_NO_TESTS)
   set(CMAKE_CXX_STANDARD 11)
   enable_language(CXX)
   enable_testing()
   add_executable(mytest test.cpp)
   target_include_directories(mytest PUBLIC ${GTEST_INCLUDE_DIRS})
   target_link_libraries(mytest ${GTEST_BOTH_LIBRARIES} GTest::GTest GTest::Main sliprock)
   if (WIN32)
      target_link_libraries(mytest -static-libstdc++ -static-libgcc -Wl,-Bstatic)
   endif()
   add_test(main mytest)
endif()
install(TARGETS sliprock sliprock_static DESTINATION "${CMAKE_INSTALL_LIBDIR}")
